# positional_uncertainty
A project to quantify and map the uncertainties associated with a RAFOS-style triangulation method, depending on source-receiver geometry. 

# formulation and user considerations 
At the most basic level, the function `map_pos_uncertainty` models inputted source positions and constructs a grid of lat/lon positions surrounding them. For each grid cell, a hypothetical receiver position is modeled. It is assumed that this receiver will record arrival times from each of the sources. The primary variable of interest from each arrival is the uncertainty in **time**, and the resulting uncertainty in **distance**. Thus, each arrival time specifies a distance carrying an associated uncertainty, which necessitates that the observed receiver position must be on a 'ring' surrounding each source; each rings central radius is the distance from the source to receiver, and the thickness of the ring is determined by the uncertainty. We can then narrow down the observed **position** of the source to the area where all these rings overlap. The area of this 'overlap zone' is then converted into a plottable variable by defining the positional uncertainty (`d_pos_radius`) as the radius of a circle with area equivalent to the overlap zone. 

The most important user consideration is how you define the uncertainty associated with an individual arrival measurement. The function, currently, defines the arrival time uncertainty (`d_arr`) as a combination of source clock drift, receiver clock drift, an approximation of a Doppler shift error, and an approximation of a multipath error. Some of these values are uniquely dependent on the conditions in which I was applying the function, **and it is critical that your formation of `d_arr` is edited to be appropriate for your use case**. `d_arr` is then multiplied by the sound speed `c` and uncertainty `dc` to convert into a range uncertainty. 

The calculation of the time and range uncertainties are located on lines 120-128 of `map_pos_uncertainty`. Below are the components of the calculation and my recommendations: 
* Source and receiver clock drift: values of typical clock drift per unit time multiplied by the deployment time `D` of the instruments. I recommend to choose clock drift values that pertain to your instruments and to edit `D` accordingly with the deployment timescales of both sources and receivers (possibly edit the code to account for two different D values if needed). 
* Doppler shifting: the Doppler shifting of a received **frequency-sweep signal** can induce an error in arrival time. The variable `V_dopp` defines a characteristic 'Doppler velocity': i.e. a velocity scale at which the receiver may move towards or away from the source, inducing Doppler error. I have generalized the formula for frequency-sweep signals by calculating the Doppler shift from the **central frequency of the signal `fs`, the length `w` of the sweep in time, and the bandwidth `B` of the signal.** This should generally work for any RAFOS-style frequency-sweep signal, so I believe it should work to input the parameters characteristic to your case and verify that the resulting error is reasonable.
* `d_arr` (the arrival **time** uncertainty) is then multiplied by the sound speed `c` and the sound speed uncertainty `dc` to convert into range. `c` and `dc` are defined earlier in the function.
* Multipathing: the final term `dR_mp`. This quantification of multipath uncertainty is a figure I arrived at through independent analysis using modeled receiver positions in BELLHOP. It should be considered as a best-guess estimate, and I **cannot** vouch for its accuracy in all cases. Because my calculation is an estimate at best, it is **doubled** in order to be conservative. If you have an alternative quantification of multipath uncertainty as a function of range, please let me know, as I had difficulty finding this relationship in literature. 

# necessary downloads/installations
`map_pos_uncertainty` makes use of: 
* m_map, a MATLAB mapping package from which I pull a couple of functions: https://www.eoas.ubc.ca/~rich/map.html#download
* The General Bathymetric Chart of the Oceans (GEBCO) grid from which I access topography in `gebco_bathy_3d`. I've verified that this function will work with the **2023 GEBCO sub-ice topo/bathy grid** which can be downloaded from https://www.gebco.net/data_and_products/gridded_bathymetry_data/.
